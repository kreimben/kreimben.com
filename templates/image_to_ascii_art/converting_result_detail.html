{% extends 'site_base.html' %}
{% load crispy_forms_filters %}
{% load image_to_ascii_art_extras %}

{% block menu %}
    {% include 'menu.html' %}
{% endblock %}

{% block content %}
    <div class="d-grid col-6 mx-auto gap-2">
        <a class="btn btn-primary text-white" href={% url 'image_to_ascii_art_view' %}>
            Generate ascii art
        </a>

        <a class="btn btn-primary text-white" href={% url 'converting_result' %}>
            Past result
        </a>
    </div>

    <div class="m-4">
        {% if result %}
            <div>
                uploaded by: {{ result.upload_image.user.username }}
            </div>
            <div>
                original image: <img class="block" width="128px"
                                     src={{ result.upload_image.image.url }} alt={{ result.upload_image.image.name }}/>
            </div>
            <div>
                uploaded at: {{ result.upload_image.created_at }}
            </div>
            <div>
                compression level: {{ result.compress_level }}
            </div>
            <div>
                converted at: {{ result.created_at }}
            </div>
            <div class="m-2">
                {% if result.is_public %}
                    <strong>Public</strong>
                    <p>anyone can see this.</p>
                {% else %}
                    <strong>Private</strong>
                    <p>Only you can see this.</p>
                {% endif %}
            </div>
            <form method="POST" class="w-25 mx-auto">
                {% csrf_token %}
                {{ form | crispy }}
                <button type="submit" class="btn btn-primary text-white">
                    Make Public/Private
                </button>
            </form>

            <div id="ascii_result" class="m-4"
                 style="white-space: pre; font-family: monospace;">{{ result.result }}</div>
            <style>
                #ascii_result {
                    font-size: {{ result.compress_level | multiply:1.4 }}px;
                }
            </style>

            <div class="m-4">
                {{ result.result | get_string_kilo_bytes }}
                ||
                {{ result.result | get_string_char_count }}
            </div>
        {% else %}
            <div class="m-4">There is no result yet!</div>
        {% endif %}
    </div>
{% endblock %}